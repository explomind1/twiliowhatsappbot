
<p align="center">
  <img src="https://github.com/explomind1/LaHacksBlocky/assets/130941980/009f3584-9f06-47e0-ac48-dbc0a170a01f" alt="Blocky" style="width: 45%; display: inline-block;"/>
  <img src="https://github.com/explomind1/LaHacksBlocky/assets/130941980/e7c28219-8309-416e-beab-0c7bb8e1e988" alt="Blocky_Architecture" style="width: 45%; display: inline-block;"/>
</p>
![d_SuSxWXmC](https://github.com/explomind1/twiliowhatsappbot/assets/130941980/dadb9316-6b78-47b9-bf23-3f9d38171f9a)<?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="472.9167px" preserveAspectRatio="none" style="width:1115px;height:472px;" version="1.1" viewBox="0 0 1115 472" width="1115.625px" zoomAndPan="magnify"><defs/><g><!--cluster AOI System--><g id="cluster_AOI System"><path d="M20.8333,16.6667 L112.5,16.6667 A6.25,6.25 0 0 1 116.6667,20.8333 L123.9583,47.8841 L831.25,47.8841 A4.1667,4.1667 0 0 1 835.4167,52.0508 L835.4167,457.1979 A4.1667,4.1667 0 0 1 831.25,461.3646 L20.8333,461.3646 A4.1667,4.1667 0 0 1 16.6667,457.1979 L16.6667,20.8333 A4.1667,4.1667 0 0 1 20.8333,16.6667 " fill="#8E8C84" style="stroke:#325D88;stroke-width:2.0833333333333335;"/><line style="stroke:#325D88;stroke-width:2.0833333333333335;" x1="16.6667" x2="123.9583" y1="47.8841" y2="47.8841"/><text fill="#325D88" font-family="Verdana" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="83.3333" x="26.0417" y="35.5611">AOI System</text></g><!--cluster Flow--><g id="cluster_Flow"><path d="M923.9583,190.5938 L966.6667,190.5938 A6.25,6.25 0 0 1 970.8333,194.7604 L978.125,221.8112 L990.625,221.8112 A4.1667,4.1667 0 0 1 994.7917,225.9779 L994.7917,335.3542 A4.1667,4.1667 0 0 1 990.625,339.5208 L923.9583,339.5208 A4.1667,4.1667 0 0 1 919.7917,335.3542 L919.7917,194.7604 A4.1667,4.1667 0 0 1 923.9583,190.5938 " fill="#8E8C84" style="stroke:#325D88;stroke-width:2.0833333333333335;"/><line style="stroke:#325D88;stroke-width:2.0833333333333335;" x1="919.7917" x2="978.125" y1="221.8112" y2="221.8112"/><text fill="#325D88" font-family="Verdana" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="34.375" x="929.1667" y="209.4882">Flow</text></g><!--entity FastAPI--><g id="elem_FastAPI"><rect fill="#325D88" height="56.2174" rx="4.1667" ry="4.1667" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="100" x="334.375" y="60.4167"/><rect fill="#325D88" height="10.4167" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="15.625" x="413.5417" y="65.625"/><rect fill="#325D88" height="2.0833" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="4.1667" x="411.4583" y="67.7083"/><rect fill="#325D88" height="2.0833" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="4.1667" x="411.4583" y="71.875"/><text fill="#FFFFFF" font-family="Verdana" font-size="12.5" lengthAdjust="spacing" textLength="47.9167" x="355.2083" y="98.0611">FastAPI</text></g><!--entity Firebase Admin--><g id="elem_Firebase Admin"><rect fill="#325D88" height="56.2174" rx="4.1667" ry="4.1667" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="152.0833" x="33.3333" y="250.4896"/><rect fill="#325D88" height="10.4167" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="15.625" x="164.5833" y="255.6979"/><rect fill="#325D88" height="2.0833" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="4.1667" x="162.5" y="257.7813"/><rect fill="#325D88" height="2.0833" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="4.1667" x="162.5" y="261.9479"/><text fill="#FFFFFF" font-family="Verdana" font-size="12.5" lengthAdjust="spacing" textLength="100" x="54.1667" y="288.134">Firebase Admin</text></g><!--entity OpenAI API--><g id="elem_OpenAI API"><rect fill="#325D88" height="56.2174" rx="4.1667" ry="4.1667" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="121.875" x="222.3958" y="250.4896"/><rect fill="#325D88" height="10.4167" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="15.625" x="323.4375" y="255.6979"/><rect fill="#325D88" height="2.0833" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="4.1667" x="321.3542" y="257.7813"/><rect fill="#325D88" height="2.0833" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="4.1667" x="321.3542" y="261.9479"/><text fill="#FFFFFF" font-family="Verdana" font-size="12.5" lengthAdjust="spacing" textLength="69.7917" x="243.2292" y="288.134">OpenAI API</text></g><!--entity Twilio API--><g id="elem_Twilio API"><rect fill="#325D88" height="56.2174" rx="4.1667" ry="4.1667" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="110.4167" x="571.875" y="250.4896"/><rect fill="#325D88" height="10.4167" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="15.625" x="661.4583" y="255.6979"/><rect fill="#325D88" height="2.0833" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="4.1667" x="659.375" y="257.7813"/><rect fill="#325D88" height="2.0833" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="4.1667" x="659.375" y="261.9479"/><text fill="#FFFFFF" font-family="Verdana" font-size="12.5" lengthAdjust="spacing" textLength="58.3333" x="592.7083" y="288.134">Twilio API</text></g><!--entity Firestore--><g id="elem_Firestore"><rect fill="#325D88" height="56.2174" rx="4.1667" ry="4.1667" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="110.4167" x="285.4167" y="388.4792"/><rect fill="#325D88" height="10.4167" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="15.625" x="375" y="393.6875"/><rect fill="#325D88" height="2.0833" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="4.1667" x="372.9167" y="395.7708"/><rect fill="#325D88" height="2.0833" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="4.1667" x="372.9167" y="399.9375"/><text fill="#FFFFFF" font-family="Verdana" font-size="12.5" lengthAdjust="spacing" textLength="58.3333" x="306.25" y="426.1236">Firestore</text></g><!--entity Twilio Client--><g id="elem_Twilio Client"><rect fill="#325D88" height="56.2174" rx="4.1667" ry="4.1667" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="127.0833" x="563.5417" y="388.4792"/><rect fill="#325D88" height="10.4167" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="15.625" x="669.7917" y="393.6875"/><rect fill="#325D88" height="2.0833" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="4.1667" x="667.7083" y="395.7708"/><rect fill="#325D88" height="2.0833" style="stroke:#2D547A;stroke-width:1.0416666666666667;" width="4.1667" x="667.7083" y="399.9375"/><text fill="#FFFFFF" font-family="Verdana" font-size="12.5" lengthAdjust="spacing" textLength="75" x="584.375" y="426.1236">Twilio Client</text></g><!--entity User--><g id="elem_User"><ellipse cx="957.2917" cy="243.7188" fill="#325D88" rx="8.3333" ry="8.3333" style="stroke:#2D547A;stroke-width:1.0416666666666667;"/><path d="M957.2917,252.0521 L957.2917,280.1771 M943.75,260.3854 L970.8333,260.3854 M957.2917,280.1771 L943.75,295.8021 M957.2917,280.1771 L970.8333,295.8021 " fill="none" style="stroke:#2D547A;stroke-width:1.0416666666666667;"/><text fill="#FFFFFF" font-family="Verdana" font-size="12.5" lengthAdjust="spacing" textLength="30.2083" x="942.1875" y="314.6965">User</text></g><!--link FastAPI to Firebase Admin--><g id="link_FastAPI_Firebase Admin"><path d="M333.9167,91.125 C252.1771,94.8333 96.4896,107.1875 62.5,147.8854 C37.6458,177.6563 59.1882,216.7401 81.1674,245.0526 " fill="none" id="FastAPI-to-Firebase Admin" style="stroke:#325D88;stroke-width:3.125;"/><polygon fill="#325D88" points="85,249.9896,82.5424,240.0291,81.8062,245.8754,75.9598,245.1392,85,249.9896" style="stroke:#325D88;stroke-width:3.125;"/></g><!--link FastAPI to OpenAI API--><g id="link_FastAPI_OpenAI API"><path d="M334.2708,89.3542 C289.1146,92.1771 225.0104,104.2917 192.7083,147.8854 C185.8125,157.1875 187.4583,163.6146 192.7083,173.9271 C195.5625,179.5417 199.5729,177.9583 204.1667,182.2604 C226.4479,203.1563 244.5905,225.2057 259.6946,245.1432 " fill="none" id="FastAPI-to-OpenAI API" style="stroke:#325D88;stroke-width:3.125;"/><polygon fill="#325D88" points="263.4688,250.125,261.1288,240.1362,260.3237,245.9735,254.4864,245.1683,263.4688,250.125" style="stroke:#325D88;stroke-width:3.125;"/></g><!--link FastAPI to OpenAI API--><g id="link_FastAPI_OpenAI API"><path d="M334.1563,93.5208 C297.8125,99.3125 251.0313,113.4583 227.0833,147.8854 C204.6563,180.1146 228.1392,217.9914 251.9725,245.4081 " fill="none" id="FastAPI-to-OpenAI API-1" style="stroke:#325D88;stroke-width:3.125;"/><polygon fill="#325D88" points="256.0729,250.125,253.0669,240.316,252.6559,246.1942,246.7777,245.7833,256.0729,250.125" style="stroke:#325D88;stroke-width:3.125;"/><text fill="#FFFFFF" font-family="Verdana" font-size="12.5" lengthAdjust="spacing" textLength="114.5833" x="233.3333" y="165.7382">Process Message</text></g><!--link OpenAI API to FastAPI--><g id="link_OpenAI API_FastAPI"><path d="M268.9063,250.0625 C255.4479,227.5104 233.1042,197.0104 204.1667,182.2604 C191.4583,175.7813 85.7917,184.3438 76.0417,173.9271 C68.125,165.4792 68.6563,156.8021 76.0417,147.8854 C108.2396,109.0313 249.051,96.2156 327.8739,91.9135 " fill="none" id="OpenAI API-to-FastAPI" style="stroke:#325D88;stroke-width:3.125;"/><polygon fill="#325D88" points="334.1146,91.5729,324.5264,87.9234,328.914,91.8568,324.9806,96.2443,334.1146,91.5729" style="stroke:#325D88;stroke-width:3.125;"/><text fill="#FFFFFF" font-family="Verdana" font-size="12.5" lengthAdjust="spacing" textLength="91.6667" x="82.2917" y="165.7382">Get Response</text></g><!--link FastAPI to Twilio API--><g id="link_FastAPI_Twilio API"><path d="M434.8438,97.7708 C468.0625,105.5521 510.4583,120.3333 538.5417,147.8854 C547.4375,156.6146 542.8333,163.0729 548.9583,173.9271 C564.5521,201.6042 582.6845,225.4207 599.4033,245.5561 " fill="none" id="FastAPI-to-Twilio API" style="stroke:#325D88;stroke-width:3.125;"/><polygon fill="#325D88" points="603.3958,250.3646,600.6126,240.4901,600.0687,246.3575,594.2013,245.8135,603.3958,250.3646" style="stroke:#325D88;stroke-width:3.125;"/></g><!--link FastAPI to Twilio API--><g id="link_FastAPI_Twilio API"><path d="M434.8854,98.7708 C469.0833,107.0313 513.7083,121.9688 545.8333,147.8854 C579.8438,175.3229 601.2039,215.3109 613.9018,244.4879 " fill="none" id="FastAPI-to-Twilio API-1" style="stroke:#325D88;stroke-width:3.125;"/><polygon fill="#325D88" points="616.3958,250.2188,616.4753,239.9598,614.3175,245.4431,608.8342,243.2852,616.3958,250.2188" style="stroke:#325D88;stroke-width:3.125;"/><text fill="#FFFFFF" font-family="Verdana" font-size="12.5" lengthAdjust="spacing" textLength="219.7917" x="576.0417" y="165.7382">Send/Receive WhatsApp Message</text></g><!--link Twilio API to FastAPI--><g id="link_Twilio API_FastAPI"><path d="M611.5729,249.9792 C597.1979,227.375 573.5625,196.8438 543.75,182.2604 C529.2708,175.1875 410.9792,184.6563 398.9583,173.9271 C383.3229,159.9792 380.29,142.0489 380.8941,123.1426 " fill="none" id="Twilio API-to-FastAPI" style="stroke:#325D88;stroke-width:3.125;"/><polygon fill="#325D88" points="381.0938,116.8958,376.6298,126.133,380.9274,122.1015,384.9589,126.3991,381.0938,116.8958" style="stroke:#325D88;stroke-width:3.125;"/><text fill="#FFFFFF" font-family="Verdana" font-size="12.5" lengthAdjust="spacing" textLength="118.75" x="405.2083" y="165.7382">Receive Response</text></g><!--link Firebase Admin to Firestore--><g id="link_Firebase Admin_Firestore"><path d="M144.4479,306.9792 C161.9271,320.0521 183.6771,335.5104 204.1667,347.8542 C229.9896,363.4063 254.2318,375.8449 279.4401,387.8449 " fill="none" id="Firebase Admin-to-Firestore" style="stroke:#325D88;stroke-width:3.125;"/><polygon fill="#325D88" points="285.0833,390.5313,278.4094,382.7396,280.3806,388.2926,274.8276,390.2639,285.0833,390.5313" style="stroke:#325D88;stroke-width:3.125;"/></g><!--link Twilio API to Twilio Client--><g id="link_Twilio API_Twilio Client"><path d="M627.0833,307.1458 C627.0833,330.7188 627.0833,358.2708 627.0833,381.8333 " fill="none" id="Twilio API-to-Twilio Client" style="stroke:#325D88;stroke-width:3.125;"/><polygon fill="#325D88" points="627.0833,388.0833,631.25,378.7083,627.0833,382.875,622.9167,378.7083,627.0833,388.0833" style="stroke:#325D88;stroke-width:3.125;"/></g><!--link User to FastAPI--><g id="link_User_FastAPI"><path d="M978.0417,237.5521 C989.5938,209.1042 997.7292,171.8229 976.0417,147.8854 C939.9583,108.0729 577.2998,94.6173 440.9352,90.9194 " fill="none" id="User-to-FastAPI" style="stroke:#325D88;stroke-width:3.125;"/><polygon fill="#325D88" points="434.6875,90.75,443.9461,95.1693,439.8939,90.8912,444.172,86.839,434.6875,90.75" style="stroke:#325D88;stroke-width:3.125;"/><text fill="#FFFFFF" font-family="Verdana" font-size="12.5" lengthAdjust="spacing" textLength="103.125" x="993.75" y="165.7382">Sends Message</text></g><!--link FastAPI to User--><g id="link_FastAPI_User"><path d="M434.5208,92.7917 C532.2292,99.6458 744.3333,117.6042 810.4167,147.8854 C839.0938,161.0313 898.9174,218.7855 932.1153,252.0355 " fill="none" id="FastAPI-to-User" style="stroke:#325D88;stroke-width:3.125;"/><polygon fill="#325D88" points="936.5313,256.4583,932.8559,246.88,932.8513,252.7726,926.9587,252.768,936.5313,256.4583" style="stroke:#325D88;stroke-width:3.125;"/><text fill="#FFFFFF" font-family="Verdana" font-size="12.5" lengthAdjust="spacing" textLength="102.0833" x="851.0417" y="165.7382">Send Response</text></g><!--link FastAPI to Firestore--><g id="link_FastAPI_Firestore"><path d="M380.6354,117.125 C379.3958,126.8333 378.0729,137.8333 377.0833,147.8854 C368.3125,236.5625 379.5625,260.3958 362.5,347.8542 C359.8542,361.4271 357.3913,370.1819 353.1413,382.3694 " fill="none" id="FastAPI-to-Firestore" style="stroke:#325D88;stroke-width:3.125;"/><polygon fill="#325D88" points="351.0833,388.2708,358.1046,380.7906,352.7983,383.3529,350.2359,378.0467,351.0833,388.2708" style="stroke:#325D88;stroke-width:3.125;"/><text fill="#FFFFFF" font-family="Verdana" font-size="12.5" lengthAdjust="spacing" textLength="105.2083" x="381.25" y="283.4361">Store User Data</text></g><!--SRC=[VP5FIyD04CNl-HHZxyMx1s5HAZb8Iwjua1x6xM2N9hjBPh68zBixQupPNKCWa3_ptflVlbo58xK4ZFR0mLcgFEeJlXCirBg6tIS7QXVmLG5erteHs02lA-IWDlKUYi-cepTa0dLeZTtdmxKdgsg8jdpmT3QDSHE362TC7KqRxXeZht4cruYqNDvEaHI2dAOOvaHbsBZX3ovrP143uwKQUrqrxjmtYbe2u9cfYndnFeGFE3Um8_any4ZCOfv5_HLVRqcJ-I1uEM9WvNrg_iUPR1fyMs9fcccwrVxCSLTy-867UmmuMx78DvtJmf72f88Ive7234XVLN_UKNRv1W00]--></g></svg>

# WhatsApp Survey Bot for AI Objectives Institute (AOI)

This repository contains the advanced codebase for a WhatsApp survey bot, leveraging FastAPI, Firebase, Twilio, and OpenAI. The bot is expertly designed to conduct structured and engaging surveys over WhatsApp, collecting valuable insights on community and personal issues directly from users.

## Key Features

- **Firebase Integration**: Manages user interaction history and session data effectively.
- **Twilio WhatsApp API**: Enables robust sending and receiving of WhatsApp messages.
- **OpenAI API**: Utilizes cutting-edge AI to deliver engaging, contextually appropriate responses.
- **FastAPI Framework**: Offers a scalable and efficient backend, ideal for real-time applications.

## Setup and Installation

### Prerequisites

- Python 3.8+
- Firebase account with a service account key
- Twilio account with WhatsApp capabilities
- OpenAI API key
- ngrok or localtunnel account for local testing
- Heroku account for deployment

### Installation Steps

1. **Clone the repository**:
   ```bash
   git clone https://github.com/yourusername/whatsapp-survey-bot.git
   cd whatsapp-survey-bot
   ```

2. **Install dependencies**:
   ```bash
   pip install -r requirements.txt
   ```

3. **Set up environment variables**:
   Create a `.env` file in the project root with the following:
   ```plaintext
   OPENAI_API_KEY='Your OpenAI API Key'
   TWILIO_ACCOUNT_SID='Your Twilio Account SID'
   TWILIO_AUTH_TOKEN='Your Twilio Auth Token'
   TWILIO_NUMBER='Your Twilio WhatsApp Number'
   GOOGLE_APPLICATION_CREDENTIALS='Path to your Firebase admin SDK JSON file'
   ```

4. **Run the server locally**:
   ```bash
   uvicorn main:app --reload
   ```

### Local Testing

To test the application locally, expose your local server to the internet using either ngrok or localtunnel:

- **Using ngrok**:
  ```bash
  ngrok http 8000
  ```
  This will provide you with a public URL that you can use in Twilio's WhatsApp webhook settings.

- **Using localtunnel**:
  ```bash
  npx localtunnel --port 8000
  ```
  Similar to ngrok, this will provide a public URL to use with Twilio.

Update the webhook URL in your Twilio dashboard to point to the URL provided by ngrok or localtunnel.

### Deployment to Heroku

1. **Create a Heroku app**:
   ```bash
   heroku create your-app-name
   ```

2. **Add buildpacks**:
   ```bash
   heroku buildpacks:set heroku/python
   ```

3. **Set environment variables on Heroku**:
   ```bash
   heroku config:set OPENAI_API_KEY='Your OpenAI API Key'
   heroku config:set TWILIO_ACCOUNT_SID='Your Twilio Account SID'
   heroku config:set TWILIO_AUTH_TOKEN='Your Twilio Auth Token'
   heroku config:set TWILIO_NUMBER='Your Twilio WhatsApp Number'
   ```

4. **Deploy your application**:
   ```bash
   git push heroku master
   ```

5. **Update Twilio's webhook URL to point to your Heroku app**.

## Usage

Begin by sending a WhatsApp message to the configured Twilio number. The bot will engage you in a conversation, guiding you through a series of structured questions to gather insights.

## Interaction Flow

- **Initial Greeting**: Warmly welcomes users and seeks consent for participation.
- **Conducting the Survey**: Methodically presents questions, maintaining clarity and focus throughout.
- **Dynamic Response Handling**: Adaptively manages user responses, prompting further discussion where necessary.
- **Conclusion**: Graciously concludes the interaction after all questions are addressed.

## Advanced Features

- **Contextual Continuity**: Keeps track of conversation context effectively, even with brief user responses.
- **Adaptive Response Management**: Smartly adjusts to varied user inputs to keep discussions on track.
- **Exception Handling**: Expertly handles unexpected inputs or deviations without disrupting the conversation flow.

